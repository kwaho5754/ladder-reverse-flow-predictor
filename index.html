<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì‚¬ë‹¤ë¦¬ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      margin-top: 60px;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }
    .summary-box {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 20px;
    }
    .card {
      border: 1px solid #aaa;
      padding: 10px;
      margin: 10px;
      flex: 1;
      background-color: #fff;
      border-radius: 6px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .card-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    ol {
      padding-left: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 5px 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <script>
    const blockSizes = [4, 8, 12];

    const modeVariants = [
      "orig", "flip_full", "flip_start", "flip_odd_even"
    ];

    const modeTitles = {
      4: "4ì¤„ ë¸”ëŸ­", 8: "8ì¤„ ë¸”ëŸ­", 12: "12ì¤„ ë¸”ëŸ­"
    };

    const transformLabel = {
      "orig": "ì›ë³¸", "flip_start": "ì‹œì‘ì  ë°˜ì „",
      "flip_odd_even": "í™€ì§ ë°˜ì „", "flip_full": "ì™„ì „ ëŒ€ì¹­"
    };

    function getFrequency(arr) {
      const counter = {};
      for (const item of arr) {
        if (!item || item === "âŒ ì—†ìŒ") continue;
        counter[item] = (counter[item] || 0) + 1;
      }
      return counter;
    }

    function formatStat(counter) {
      return Object.entries(counter)
        .sort((a, b) => b[1] - a[1])
        .map(([k, v]) => `${k}(${v})`)
        .join(", ");
    }

    function renderGroupedSummary(stats, blockSize) {
      const container = document.getElementById(`grouped-summary-${blockSize}`);
      container.innerHTML = "";

      for (const group in stats) {
        const box = document.createElement("div");
        box.className = "summary-box";

        const title = document.createElement("h2");
        title.textContent = `ğŸ“Š ${transformLabel[group]} í†µê³„`;
        box.appendChild(title);

        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr><th>êµ¬ë¶„</th><th>ê°’(íšŸìˆ˜)</th></tr>
          </thead>
          <tbody>
            <tr><td>ìƒë‹¨</td><td>${formatStat(stats[group].top)}</td></tr>
            <tr><td>í•˜ë‹¨</td><td>${formatStat(stats[group].bottom)}</td></tr>
          </tbody>
        `;
        box.appendChild(table);
        container.appendChild(box);
      }
    }

    function createCard(mode, data, blockSize) {
      const card = document.createElement("div");
      card.className = "card";

      const label = document.createElement("h3");
      label.textContent = `${modeTitles[blockSize]} (${transformLabel[mode]}) (íšŒì°¨ ${data["ì˜ˆì¸¡íšŒì°¨"]})`;
      card.appendChild(label);

      const topLabel = document.createElement("h4");
      topLabel.textContent = "ğŸ”º ìƒë‹¨ê°’ ì˜ˆì¸¡";
      card.appendChild(topLabel);

      const topList = document.createElement("ol");
      for (const match of data["ìƒë‹¨ê°’ë“¤"] || []) {
        const item = document.createElement("li");
        item.textContent = `${match["ê°’"]} | ë¸”ëŸ­: ${match["ë¸”ëŸ­"]} | ìˆœë²ˆ: ${match["ìˆœë²ˆ"]}`;
        topList.appendChild(item);
      }
      card.appendChild(topList);

      const bottomLabel = document.createElement("h4");
      bottomLabel.textContent = "ğŸ”» í•˜ë‹¨ê°’ ì˜ˆì¸¡";
      card.appendChild(bottomLabel);

      const bottomList = document.createElement("ol");
      for (const match of data["í•˜ë‹¨ê°’ë“¤"] || []) {
        const item = document.createElement("li");
        item.textContent = `${match["ê°’"]} | ë¸”ëŸ­: ${match["ë¸”ëŸ­"]} | ìˆœë²ˆ: ${match["ìˆœë²ˆ"]}`;
        bottomList.appendChild(item);
      }
      card.appendChild(bottomList);

      return card;
    }

    async function loadSet(blockSize) {
      const resultContainer = document.getElementById(`results-${blockSize}`);
      resultContainer.innerHTML = "";
      const section = document.createElement("div");
      section.className = "section";

      const title = document.createElement("h2");
      title.textContent = `${blockSize}ì¤„ ë¸”ëŸ­ ì˜ˆì¸¡`;
      section.appendChild(title);

      const row = document.createElement("div");
      row.className = "card-row";
      section.appendChild(row);

      resultContainer.appendChild(section);

      const grouped = {
        orig: { top: [], bottom: [] },
        flip_full: { top: [], bottom: [] },
        flip_start: { top: [], bottom: [] },
        flip_odd_even: { top: [], bottom: [] },
      };

      for (const variant of modeVariants) {
        const mode = `${blockSize}block_${variant}`;
        try {
          const res = await fetch(`/predict?mode=${mode}`);
          const data = await res.json();

          grouped[variant].top.push(...(data["ìƒë‹¨ê°’ë“¤"] || []).map(t => t["ê°’"]));
          grouped[variant].bottom.push(...(data["í•˜ë‹¨ê°’ë“¤"] || []).map(t => t["ê°’"]));

          row.appendChild(createCard(variant, data, blockSize));
        } catch (e) {
          console.error(`âŒ ì˜¤ë¥˜: ${mode} ì˜ˆì¸¡ ì‹¤íŒ¨`, e);
        }
      }

      renderGroupedSummary(grouped, blockSize);
    }

    function init() {
      for (const size of blockSizes) {
        const container = document.createElement("div");
        container.innerHTML = `
          <h1>ğŸ”® ${size}ì¤„ ë¸”ëŸ­ ì˜ˆì¸¡ ê²°ê³¼</h1>
          <div id="grouped-summary-${size}"></div>
          <div id="results-${size}"></div>
        `;
        document.body.appendChild(container);
        loadSet(size);
      }
    }

    window.onload = init;
  </script>
</body>
</html>
