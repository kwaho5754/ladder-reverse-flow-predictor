<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>사다리 예측 시스템</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; }
    .set { border: 1px solid #444; border-radius: 8px; padding: 10px; margin-bottom: 20px; background: #1e1e1e; }
    h2 { color: #66f; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #666; padding: 4px; text-align: center; }
    .card-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .card { border: 1px solid #888; border-radius: 8px; padding: 6px 10px; background: #222; }
  </style>
</head>
<body>
  <h1>사다리 예측 시스템 - 3쌍둥이 (4/8/12 제한)</h1>
  <div id="container"></div>

  <script>
    const modes = [
      "3block_orig", "3block_flip_full", "3block_flip_start", "3block_flip_odd_even",
      "4block_orig", "4block_flip_full", "4block_flip_start", "4block_flip_odd_even"
    ];

    async function loadSet(limit, title) {
      const container = document.getElementById("container");
      const wrapper = document.createElement("div");
      wrapper.className = "set";

      const heading = document.createElement("h2");
      heading.textContent = title;
      wrapper.appendChild(heading);

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      thead.innerHTML = `<tr><th>구분</th><th>예측값</th><th>횟수</th></tr>`;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      const totalCounts = {};

      for (const mode of modes) {
        const res = await fetch(`/predict?mode=${mode}&limit=${limit}`);
        const data = await res.json();

        for (const group of ["상단값들", "하단값들"]) {
          data[group].forEach(item => {
            const key = item.값;
            totalCounts[key] = (totalCounts[key] || 0) + 1;
          });
        }

        const modeTitle = document.createElement("div");
        modeTitle.innerHTML = `<h4>${mode}</h4>`;
        wrapper.appendChild(modeTitle);

        const cards = document.createElement("div");
        cards.className = "card-container";

        for (const group of ["상단값들", "하단값들"]) {
          data[group].forEach(item => {
            const card = document.createElement("div");
            card.className = "card";
            card.textContent = `${group === "상단값들" ? "▲" : "▼"} ${item.값} (${item.블럭}) #${item.순번}`;
            cards.appendChild(card);
          });
        }

        wrapper.appendChild(cards);
      }

      const sorted = Object.entries(totalCounts).sort((a, b) => b[1] - a[1]).slice(0, 4);
      sorted.forEach(([val, count]) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>Top</td><td>${val}</td><td>${count}</td>`;
        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      wrapper.appendChild(table);
      container.appendChild(wrapper);
    }

    loadSet(4, "세트 1 - 4개 제한");
    loadSet(8, "세트 2 - 8개 제한");
    loadSet(12, "세트 3 - 12개 제한");
  </script>
</body>
</html>
