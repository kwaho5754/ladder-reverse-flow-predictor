<script>
  fetch("/predict")
    .then((res) => res.json())
    .then((data) => {
      document.getElementById("round").innerHTML = `<div class="card"><span class="label">예측 회차:</span> ${data["예측회차"]}</div>`;

      const showRecent = (list, targetId, title) => {
        const html = list.map((v, i) => `<div>${i + 1} : ${v}</div>`).join("");
        document.getElementById(targetId).innerHTML = `<div class="card"><span class="label">${title} (최신 ↓ 과거):</span> ${html}</div>`;
      };

      const showCombinedTop3 = (result, resultRotated, targetId) => {
        const container = document.getElementById(targetId);
        container.innerHTML = "";

        const allKeys = Object.keys(result);
        for (const key of allKeys) {
          const card = document.createElement("div");
          card.className = "card";

          const label = document.createElement("div");
          label.className = "label";
          label.textContent = key;
          card.appendChild(label);

          result[key]?.forEach(v => {
            const div = document.createElement("div");
            div.className = "value";
            div.textContent = `${v.value} (${v.count})`;
            card.appendChild(div);
          });

          if (resultRotated[key]?.length) {
            const divider = document.createElement("div");
            divider.className = "divider";
            divider.textContent = "(180도)";
            card.appendChild(divider);

            resultRotated[key].forEach(v => {
              const div = document.createElement("div");
              div.className = "value";
              div.textContent = `${v.value} (${v.count})`;
              card.appendChild(div);
            });
          }

          container.appendChild(card);
        }
      };

      const showFirstMatches = (matches) => {
        const container = document.getElementById("first-match");
        let html = "";
        for (const key of ["3줄", "4줄", "5줄"]) {
          const info = matches[key];
          const block = (info?.["블럭"] || []).join(" → ") || "(없음)";
          const top = info?.["상단"] || "(없음)";
          const bottom = info?.["하단"] || "(없음)";
          html += `
            <div class="card">
              <span class="label">✅ ${key} 블럭 첫 매칭</span>
              <div>블럭: ${block}</div>
              <div>상단값: ${top}</div>
              <div>하단값: ${bottom}</div>
            </div>
          `;
        }
        container.innerHTML = html;
      };

      showRecent(data["최근블럭3"], "recent3", "최근 3줄 블럭");
      showCombinedTop3(data["Top3_3줄"], data["Top3_3줄_180도"], "result3");

      showRecent(data["최근블럭4"], "recent4", "최근 4줄 블럭");
      showCombinedTop3(data["Top3_4줄"], data["Top3_4줄_180도"], "result4");

      showFirstMatches(data["처음매칭"]);
    })
    .catch((error) => {
      document.body.innerHTML = `<div class="container"><div class="card">예측 데이터를 불러오는 중 오류 발생: ${error}</div></div>`;
    });
</script>
